<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Audiowide">
	<style type="text/css">
		body  {
    		background-image: url("images/background_horde.jpg");
    		background-repeat:no-repeat;
    		background-size:100% 100vh;
			font-family: 'Audiowide', serif;
			font-size: 13px;
			color: #D7D9D9;
		}
		
	
	</style>	
</head>
<body>
  <script type="text/javascript">
var xhttp = new XMLHttpRequest();
xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
       // Typical action to be performed when the document is ready:
       var rawJson = this.responseText
       var json = JSON.parse(rawJson)
       workit(json)
    }
};
xhttp.open("GET", "https://eu.api.battle.net/wow/guild/dentarg/AeoN?fields=members&locale=en_GB&apikey=vra69wc2sq5c6kfmqachabmyugxgsh56", true);
xhttp.send();

function workit(json) {
	var frame = "images/frame.png"
	var maxWidth = window.innerWidth;
	var maxHeight = window.innerHeight;
	var maxPortraitsPerLine = (Math.floor(maxWidth / 190)) - 3;
	var membersLength = json.members.length;
	
	var baseLeftImg = 54;
	var baseTopImg = 29;
	var baseLeftFrame = 30;
	var baseTopFrame = -13;
	
	var imgWidthAndHeight = 78;
	var frameWidthAndHeight = 160;
	
	var offsetX = 90;
	var offsetY = 20;
	
	var line = 1;
	var resultingInnerHtml;

	
	
	console.log(json)

	for (var i = 0;i < maxPortraitsPerLine; i++) {
		
		var thumbnail = json.members[i].character.thumbnail
		var thumbnail = "http://render-eu.worldofwarcraft.com/character/" + returnCharacterImgID(thumbnail) + "-avatar.jpg"
		var charName  = json.members[i].character.name
		var lvl = json.members[i].character.level
		var wowclassNumber = json.members[i].character.class
		var wowclass = returnWowClass(wowclassNumber);

		if (i == 0) {
			resultingInnerHtml = '<img id="img' + 0 + '" src=' + thumbnail + ' width="'+ imgWidthAndHeight +'" height="'+ imgWidthAndHeight +'" style="position:absolute;left:'+ baseLeftImg +';top:'+ baseTopImg +'"></img><img id="frame' + 0 + '" src=' + frame + ' width="'+ frameWidthAndHeight +'" height="'+ frameWidthAndHeight +'" style="position:absolute;left:'+ baseLeftFrame +';top:'+ baseTopFrame +'"></img><h2 id="txt'+ 0 +'">'+ charName +'</h2><h3 style="color:#a6a6a6;" id="class'+ 0 +'">'+ wowclass +'</h3><h3 id="lvl'+ 0 +'">'+ lvl +'</h3>'
		} else {
			resultingInnerHtml += '<img id="img' + i + '" src=' + thumbnail + ' width="'+ imgWidthAndHeight +'" height="'+ imgWidthAndHeight +'" style="position:absolute;left:'+ baseLeftImg +';top:'+ baseTopImg +'"></img><img id="frame' + i + '" src=' + frame + ' width="'+ frameWidthAndHeight +'" height="'+ frameWidthAndHeight +'" style="position:absolute;left:'+ baseLeftFrame +';top:'+ baseTopFrame +'"></img><h2 id="txt'+ i +'">'+ charName +'</h2><h3 style="color:#a6a6a6;" id="class'+ i +'">'+ wowclass +'</h3><h3 id="lvl'+ i +'">'+ lvl +'</h3>'
		}
	}
	var div = document.createElement('div');
	div.setAttribute("id", "div0");
	div.innerHTML = resultingInnerHtml;
	document.body.appendChild(div);
	
	for (var i = 0; i < maxPortraitsPerLine; i++) {
		var currentIdImg = "img" + i;
		var currentIdFrame = "frame" + i;
		var currentIdText = "txt" + i;
		var currentIdClass = "class" + i;
		var currentIdLvl = "lvl" + i;
		var leftOffsetImg = baseLeftImg;
		var leftOffsetFrame = baseLeftFrame;
		
		/*
		var topOffsetImg = document.getElementById(currentIdImg).offsetTop;
		var topOffsetFrame = document.getElementById(currentIdFrame).offsetLeft;
		*/
		baseLeftImg = leftOffsetImg + frameWidthAndHeight + offsetX;
		baseLeftFrame = leftOffsetFrame + frameWidthAndHeight + offsetX;
		
		repositionElement(currentIdImg, leftOffsetImg + "px", 25 + "px");
		repositionElement(currentIdFrame, leftOffsetFrame + "px", -10 + "px");
		repositionElement(currentIdText, (leftOffsetImg) + "px", 120 + "px");
		repositionElement(currentIdClass, (leftOffsetImg) + "px", 140 + "px");
		repositionElement(currentIdLvl, (leftOffsetImg + 54) + "px", 67 + "px");
	}
}
function returnWowClass(wowclass) {
	var wowClass = {
	    hunter : "Hunter",
	    warrior : "Warrior",
		paladin : "Paladin",
		rogue : "Rogue",
		priest : "Priest",
		deathknight : "Death Knight",
		shaman : "Shaman",
		mage : "Mage",
		warlock : "Warlock",
		monk : "Monk",
		druid : "Druid",
		demonhunter : "Demon Hunter"
	};
	var wc;
	if (wowclass == '3') {
		wc = wowClass.hunter
	} else if (wowclass == '2') {
		wc = wowClass.paladin
	} else if (wowclass == '6') {
		wc = wowClass.deathknight
	} else if (wowclass == '7') {
		wc = wowClass.shaman
	} else if (wowclass == '4' || wowclass == '12') {
		wc = wowClass.rogue
	} else if (wowclass == '1') {
		wc = wowClass.warrior
	} else if (wowclass == '11') {
		wc = wowclass.druid
	} else if (wowclass == '10') {
		wc = wowclass.monk
	}

	return wc;
}

function repositionElement(elementId, styleLeft, styleTop) {
	var d = document.getElementById(elementId);
	d.style.position = "absolute";
	d.style.left = styleLeft;
	d.style.top = styleTop;
}

function returnCharacterImgID(thumbnail) {
	var characterImgId = thumbnail.substr(0, thumbnail.length - 11);
	return characterImgId;
}
</script>

</body>
</html>