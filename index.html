<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Audiowide">
	<style type="text/css">
		body  {
    		background-image: url("images/background_horde.jpg");
    		background-repeat:no-repeat;
    		background-size:100% 100vh;
			font-family: 'Audiowide', serif;
			font-size: 13px;
			color: #D7D9D9;
			overflow: hidden;
		}

		div {
		    width: 100%;
    		height: 80%;
		    overflow: auto;
		}

	
	</style>	
</head>
<body>
<script type="text/javascript">

startApiCallGuild()

function startApiCallGuild() {
	var xhttp = new XMLHttpRequest();
	xhttp.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200) {
		   // Typical action to be performed when the document is ready:
		   var rawJson = this.responseText
		   var jsonGuild = JSON.parse(rawJson)
		   startApiCallClasses(jsonGuild)
		}
	};
	xhttp.open("GET", "https://eu.api.battle.net/wow/guild/dentarg/AeoN?fields=members&locale=en_GB&apikey=vra69wc2sq5c6kfmqachabmyugxgsh56", true);
	xhttp.send();
}

function startApiCallClasses(guildJson) {
	var jsonGuild = guildJson
	var xhttp = new XMLHttpRequest();
	xhttp.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200) {
		   // Typical action to be performed when the document is ready:
		   var rawJson = this.responseText
		   var jsonClasses = JSON.parse(rawJson)
		   workit(jsonClasses, jsonGuild)
		}
	};
	xhttp.open("GET", "https://eu.api.battle.net/wow/data/character/classes?locale=en_GB&apikey=vra69wc2sq5c6kfmqachabmyugxgsh56", true);
	xhttp.send();
}

function workit(jsonClasses, jsonGuild) {
	var jsonClasses = jsonClasses
	var json = jsonGuild
	var frame = "images/frame.png"
	var maxWidth = window.innerWidth;
	var maxHeight = window.innerHeight;
	var maxPortraitsPerLine = Math.floor(maxWidth / 240)

	var membersLength = json.members.length;
	var lines = Math.ceil(membersLength /maxPortraitsPerLine)

	var baseLeftImg = 54;
	var baseTopImg = 29;
	var baseLeftFrame = 30;
	var baseTopFrame = -13;
	
	var imgWidthAndHeight = 78;
	var frameWidthAndHeight = 160;
	
	var offsetX = 70;
	var offsetY = 20;
	
	var line = 1;
	var resultingInnerHtml;

	var titleAeon = document.createElement('div');
	titleAeon.setAttribute("id", "titleAeon");
	titleAeon.innerHTML = "<h1 style=\"font-size:500%;left:45%;position:absolute\">AeoN";
	document.body.appendChild(titleAeon);	
	
	var titleDentarg = document.createElement('div');
	titleDentarg.setAttribute("id", "titleDentarg");
	titleDentarg.innerHTML = "<h4 style=\"font-size:100%;left:48%;top:5%;position:absolute\">Tarren Mill";
	document.body.appendChild(titleDentarg);	
	
	console.log(json)

	for (var i = 0;i < membersLength; i++) {
		console.log(returnRank( json.members[i].rank))
		var thumbnail = json.members[i].character.thumbnail
		var thumbnail = "http://render-eu.worldofwarcraft.com/character/" + returnCharacterImgID(thumbnail) + "-avatar.jpg"
		var charName  = json.members[i].character.name
		var lvl = json.members[i].character.level
		var wowclassNumber = json.members[i].character.class
		var wowclass = returnWowClass(jsonClasses, wowclassNumber);

		if (i == 0) {
			resultingInnerHtml = '<img id="img' + 0 + '" src=' + thumbnail + ' width="'+ imgWidthAndHeight +'" height="'+ imgWidthAndHeight +'"></img><img id="frame' + 0 + '" src=' + frame + ' width="'+ frameWidthAndHeight +'" height="'+ frameWidthAndHeight +'"></img><h2 id="txt'+ 0 +'">'+ charName +'</h2><h3 style="color:#a6a6a6;" id="class'+ 0 +'">'+ wowclass +'</h3><h4 id="lvl'+ 0 +'">'+ lvl +'</h4>'
		} else {
			resultingInnerHtml += '<img id="img' + i + '" src=' + thumbnail + ' width="'+ imgWidthAndHeight +'" height="'+ imgWidthAndHeight +'"></img><img id="frame' + i + '" src=' + frame + ' width="'+ frameWidthAndHeight +'" height="'+ frameWidthAndHeight +'"></img><h2 id="txt'+ i +'">'+ charName +'</h2><h3 style="color:#a6a6a6;" id="class'+ i +'">'+ wowclass +'</h3><h4 id="lvl'+ i +'">'+ lvl +'</h4>'
		}
	}

	var div = document.createElement('div');
	div.setAttribute("id", "roster");
	div.innerHTML = resultingInnerHtml;
	document.body.appendChild(div);

	repositionElement("roster", "30px", "150px");

	var numYimg = 25
	var numYframe = -10
	var numYtext = 120
	var numYclass = 140
	var numYlvl = 67
	var numOffsetY = 180
	var currentItemTracker = 0


	for (var k = 1; k <= lines; k++) {
		for (var i = 0; i < maxPortraitsPerLine; i++) {
			var currentIdImg = "img" + currentItemTracker;
			var currentIdFrame = "frame" + currentItemTracker;
			var currentIdText = "txt" + currentItemTracker;
			var currentIdClass = "class" + currentItemTracker;
			var currentIdLvl = "lvl" + currentItemTracker;
			var leftOffsetImg = baseLeftImg;
			var leftOffsetFrame = baseLeftFrame;
			
			
			baseLeftImg = leftOffsetImg + frameWidthAndHeight + offsetX;
			baseLeftFrame = leftOffsetFrame + frameWidthAndHeight + offsetX;
			
			repositionElement(currentIdImg, leftOffsetImg + "px", numYimg + "px");
			repositionElement(currentIdFrame, leftOffsetFrame + "px", numYframe + "px");
			repositionElement(currentIdText, (leftOffsetImg) + "px", numYtext + "px");
			repositionElement(currentIdClass, (leftOffsetImg) + "px", numYclass + "px");
			repositionElement(currentIdLvl, (leftOffsetImg + 56) + "px", numYlvl + "px");
			currentItemTracker++
		}
		numYimg = numYimg + numOffsetY
		numYframe = numYframe + numOffsetY
		numYtext = numYtext + numOffsetY
		numYclass = numYclass + numOffsetY
		numYlvl = numYlvl + numOffsetY

		baseLeftImg = 54
		baseLeftFrame = 30
	}
	
}
function returnWowClass(jsonClasses, wowclass) {
	
	var wc;
	for (var i = 0; i < jsonClasses.classes.length; i++) {
		
		if (jsonClasses.classes[i].id == wowclass) {
			
			wc = jsonClasses.classes[i].name
			i = jsonClasses.classes.length
		}
	}
	return wc;
}

function returnRank(rank) {
	var ranks = {
		gm : "Dear Leader, Kim Il'sung's long lost bro",
		eternal: "Eternal",
		oldblood: "Old Blood",
		darkblood: "Dark Blood",
		highblood: "High Blood",
		blood: "Blood",
		alt: "Alt",
		trial: "Trial",
	}
	var guildRank
	
	if (rank == 0) {
		guildRank = ranks.gm
	} else if (rank == 1) {
		guildRank = ranks.eternal
	} else if (rank == 2) {
		guildRank = ranks.oldblood
	} else if (rank == 3) {
		guildRank = ranks.darkblood
	} else if (rank == 4) {
		guildRank = ranks.highblood
	} else if (rank == 5) {
		guildRank = ranks.blood
	} else if (rank == 6) {
		guildRank = ranks.alt
	} else if (rank == 7) {
		guildRank = ranks.trial
	}
	
	return guildRank;
}

function repositionElement(elementId, styleLeft, styleTop) {
	var d = document.getElementById(elementId);
	d.style.position = "absolute";
	d.style.left = styleLeft;
	d.style.top = styleTop;
}

function returnCharacterImgID(thumbnail) {
	var characterImgId = thumbnail.substr(0, thumbnail.length - 11);
	return characterImgId;
}
</script>

</body>
</html>